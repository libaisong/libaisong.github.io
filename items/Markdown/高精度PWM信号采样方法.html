<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>高精度PWM信号采样方法</title>
</head>

<body class='typora-export os-windows'>
<div id='write'  class=''><h1><a name="高精度pwm信号采样方法" class="md-header-anchor"></a><span>高精度PWM信号采样方法</span></h1><p><span>脉宽调制（PWM，Pulse Width Modulation）是工控领域常用技术，可以实现直流信号和交流信号的转换，广泛应用于电机控制、电源、储能等领域。PWM信号一般通过主控芯片的定时器产生，定时器根据占空比以及PWM周期就可以输出期望的PWM信号。某些应用场景下，需要获取精确的PWM信号，以对输出电压进行分析，比如示波器、硬件在环（HIL， Hardware In the Loop）设备等。本文将对如何采集高精度的PWM信号进行介绍。  </span></p><h2><a name="1-电平采样" class="md-header-anchor"></a><span>1. 电平采样</span></h2><p><span>使用DI端口直接对PWM信号进行采样是很容易想到的方法，在一个PWM周期内，对信号电平进行采样，高电平出现的次数除以总的采样次数，就得到了占空比。下图为电平采样的示意图，图中的实心箭头代表电平采样时刻。这种方法编程实现难度较低，但采样精度与采样频率直接相关，采样频率越高，采样精度就越高，比如，如果采样频率为10MHz，也就是0.1us采样周期，那么采样载波频率为10kHz的PWM信号，采样得到的占空比误差可以达到0.1%，可以满足大多数应用的要求。此外，即使在PWM载波频率未知的情况下，依然可以很好地实现高精度采样。但是采样频率的提高，对于控制器就有着较高的要求，一般单片机很难做到10MHz的采样率，通常需要使用FPGA或者CPLD来实现，这就推高了整个系统的成本。当然，对于一些对成本不敏感的应用场合，这种方案还是首选。  </span></p><p><img src="高精度PWM信号采样方法-电平采样.svg" referrerpolicy="no-referrer" alt="电平采样"></p><h2><a name="2-边沿采样" class="md-header-anchor"></a><span>2. 边沿采样</span></h2><p><span>如果想在保证采样精度的同时，降低采样频率，可以采用边沿采样的方法。这种方法可以利用单片机定时器的捕获功能，采集PWM边沿发生的时刻，从而计算出占空比。下图为边沿采样的示意图，图中空心箭头代表边沿采样时刻。这种方法对主控芯片要求相对较低，但可以保证较高的采样率。但这种方法有个的问题，如果PWM信号占空比为100%或者0%，也就是常高或者常低，边沿采样法是无法准确描述这种状态的。  </span></p><p><img src="高精度PWM信号采样方法-边沿采样.svg" referrerpolicy="no-referrer" alt="边沿采样"></p><h2><a name="3-混合采样" class="md-header-anchor"></a><span>3. 混合采样</span></h2><p><span>边沿采样实现成本相对较低，如果能够优化一下，实现常高或者常低状态的准确采样，那么就可以兼顾成本和精度。一种可行的方案是，在进行边沿采样的时，也进行电平采样，当出现常高或者常低状态时，通过电平来进行判断，就解决了常规边沿采样的问题。下图为混合采样的示意图，图中空心箭头代表边沿采样时刻，实心箭头代表电平采样时刻，每个采样周期，只进行一次电平采样就可以满足要求，因此电平采样的采样频率不需要很高，很多单片机的DI端口就可以满足。对于更复杂情况，比如每个采样周期内只有一个边沿，或者多于两个边沿的情况，该方法依然可以准确采样，这里不再展开讨论。  </span></p><p><img src="高精度PWM信号采样方法-混合采样.svg" referrerpolicy="no-referrer" alt="混合采样"></p></div>
</body>
</html>